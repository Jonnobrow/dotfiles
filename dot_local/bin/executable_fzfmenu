#!/bin/sh
FZF_DEFAULT_OPTS=
profile=
dmenu=

while getopts pd opt; do
  case $opt in
  p) profile=1 ;;
  d) dmenu=1 ;;
  ?)
    printf 'Usage: %s -p|-d\n' "$0"
    exit 2
    ;;
  esac
done

if [ -n "$profile" ]; then
  temp=$(mktemp)
  foot -T 'foot-float' \
    sh -c "fd -t d -d 1 -I '[a-zA-Z0-9]\.+' --base-directory ~/.mozilla/firefox\
    | fzf --no-sort > $temp"
  if [ -s "$temp" ]; then
    nohup firefox --profile "$HOME"/.mozilla/firefox/"$(cat "$temp")" >/dev/null 2>&1 &
  else
    printf '%s is empty' "$temp"
  fi
fi

if [ -n "$dmenu" ]; then
  foot -T 'foot-float' sh -c "fzf --no-sort < /proc/$$/fd/0 > /proc/$$/fd/1"
fi
